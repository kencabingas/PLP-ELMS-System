{% extends "base.html" %}

{% block title %}{{ class_info.title }} - ClassHub{% endblock %}

{% block content %}
<!-- Class Hero -->
<div class="class-hero">
    <div class="class-hero-content">
        <h1>{{ class_info.title }}</h1>
        <p>{{ class_info.section or 'No section' }} ‚Ä¢ {{ class_info.subject or 'General' }}</p>
        <div class="class-info">
            <div class="class-info-item">
                <span>üë§</span>
                <span>{{ class_info.teacher_name }}</span>
            </div>
            {% if class_info.room %}
                <div class="class-info-item">
                    <span>üìç</span>
                    <span>Room {{ class_info.room }}</span>
                </div>
            {% endif %}
            <div class="class-info-item">
                <span>üîë</span>
                <span>Class Code: <strong>{{ class_info.class_code }}</strong></span>
                <button onclick="copyClassCode('{{ class_info.class_code }}')" class="btn btn-outline" style="margin-left: 0.5rem; padding: 0.25rem 0.75rem; font-size: 0.85rem;">Copy</button>
            </div>
        </div>
    </div>
</div>

<!-- Tab Navigation -->
<nav class="tab-navigation">
    <div class="tab-nav">
        <a href="#stream" class="active" onclick="switchTab('stream')">Stream</a>
        <a href="#classwork" onclick="switchTab('classwork')">Classwork</a>
        <a href="#people" onclick="switchTab('people')">People</a>
    </div>
</nav>

<!-- Tab Content -->
<div class="tab-content" id="stream-tab">
    {% if session.role == 'teacher' %}
        <button class="btn btn-primary" onclick="openModal('announcement-modal')" style="margin-bottom: 2rem;">
            + Post Announcement
        </button>
    {% endif %}

    {% if announcements %}
        {% for announcement in announcements %}
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">{{ announcement.full_name[0] }}</div>
                    <div class="card-header-content">
                        <h3>{{ announcement.title }}</h3>
                        <div class="card-meta">
                            <span>{{ announcement.full_name }}</span>
                            <span>‚Ä¢</span>
                            <span>{{ announcement.created_at }}</span>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <p>{{ announcement.content }}</p>
                </div>
                <div class="card-footer">
                    <button class="btn btn-secondary">üí¨ Comment</button>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">üì¢</div>
            <h3>No announcements yet</h3>
            <p>Stay tuned for updates from your teacher</p>
        </div>
    {% endif %}
</div>

<div class="tab-content" id="classwork-tab" style="display: none;">
    {% if session.role == 'teacher' %}
        <a href="{{ url_for('create_assignment', class_id=class_info.id) }}" class="btn btn-primary" style="margin-bottom: 2rem;">
            + Create Assignment
        </a>
    {% endif %}

    {% if assignments %}
        <div class="assignment-grid">
            {% for assignment in assignments %}
                <a href="{{ url_for('assignment_view', assignment_id=assignment.id) }}" class="card" style="text-decoration: none; color: inherit;">
                    <div class="card-header">
                        <div class="card-icon">
                            {% if assignment.assignment_type == 'quiz' %}‚úì
                            {% elif assignment.assignment_type == 'material' %}üìö
                            {% else %}üìÑ{% endif %}
                        </div>
                        <div class="card-header-content">
                            <h3>{{ assignment.title }}</h3>
                            <div class="card-meta">
                                <span class="badge badge-{{ assignment.assignment_type }}">
                                    {{ assignment.assignment_type|capitalize }}
                                </span>
                                {% if assignment.due_date %}
                                    <span>Due: {{ assignment.due_date }}</span>
                                {% endif %}
                                {% if assignment.points %}
                                    <span>{{ assignment.points }} points</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% if assignment.description %}
                        <div class="card-body">
                            <p>{{ assignment.description[:100] }}{% if assignment.description|length > 100 %}...{% endif %}</p>
                        </div>
                    {% endif %}
                </a>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">üìù</div>
            <h3>No assignments yet</h3>
            <p>Check back later for classwork and assignments</p>
        </div>
    {% endif %}
</div>

<div class="tab-content" id="people-tab" style="display: none;">
    <div class="people-section">
        <h2>Teacher</h2>
        <div class="people-grid">
            <div class="person-card">
                <div class="person-avatar">{{ teacher.full_name[0] }}</div>
                <div class="person-info">
                    <h3>{{ teacher.full_name }}</h3>
                    <p>{{ teacher.email }}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="people-section">
        <h2>Students ({{ students|length }})</h2>
        {% if students %}
            <div class="people-grid">
                {% for student in students %}
                    <div class="person-card">
                        <div class="person-avatar">{{ student.full_name[0] }}</div>
                        <div class="person-info">
                            <h3>{{ student.full_name }}</h3>
                            <p>{{ student.email }}</p>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üë•</div>
                <h3>No students enrolled yet</h3>
                <p>Share the class code for students to join</p>
            </div>
        {% endif %}
    </div>
</div>

<!-- Announcement Modal -->
<div class="modal-overlay" id="announcement-modal">
    <div class="modal">
        <div class="modal-header">
            <h2>Post Announcement</h2>
            <button class="modal-close" onclick="closeModal('announcement-modal')">√ó</button>
        </div>
        <form id="announcement-form" onsubmit="return postAnnouncement({{ class_info.id }})">
            <div class="modal-body">
                <div class="form-group">
                    <label for="title">Title</label>
                    <input type="text" id="title" name="title" placeholder="Announcement title..." required>
                </div>
                <div class="form-group">
                    <label for="content">Content</label>
                    <textarea id="content" name="content" placeholder="Share something with your class..." required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('announcement-modal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Post</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Tab switching without page reload
document.querySelectorAll('.tab-nav a').forEach(link => {
    link.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Remove active from all
        document.querySelectorAll('.tab-nav a').forEach(a => a.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
        
        // Add active to clicked
        this.classList.add('active');
        const tabId = this.getAttribute('href').substring(1) + '-tab';
        document.getElementById(tabId).style.display = 'block';
    });
});
</script>
{% endblock %}
